<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mandelbrot Set in HTML Canvas</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
    }
    canvas {
        display: block;
    }
</style>
</head>
<body>
<canvas id="mandelbrotCanvas" width="400" height="400"></canvas>

<script>
// Function to compute complex power
function p(z, n) {
    let lpv = { real: 0.0, imag: 0.0 };
    for (let i = 0; i < n; i++) {
        lpv = {
            real: lpv.real * lpv.real - lpv.imag * lpv.imag + z.real,
            imag: 2 * lpv.real * lpv.imag + z.imag
        };
    }
    return Math.sqrt(lpv.real * lpv.real + lpv.imag * lpv.imag) - 1;
}

// Function to compute the color of a point in the Mandelbrot set
function color(c, power, bailout, iterations, R, G, B, subframe) {
    let z = { real: 0, imag: 0 };
    let d = Math.abs(p(z, subframe) - 1);
    let val = bailout;

    for (let i = 0; i < iterations; i++) {
        // Calculate Z
        z = {
            real: z.real * z.real - z.imag * z.imag + c.real,
            imag: 2 * z.real * z.imag + c.imag
        };


        d = Math.abs(p(z, subframe));

        if (d < val) {
            val = d;
        }
        // Check bailout
        if (Math.sqrt(z.real * z.real + z.imag * z.imag) > bailout) {
            break;
        }
    }

    console.log(val);
    // Map the number of iterations to a color gradient
    const a = val;
    return [(R * Math.abs((1.0 - a) * (1.0 - a)))*255, (G * Math.abs(a * a))*255, (B * Math.abs(2.0 * (1.0 - a) * a))*255];
}


// Function to convert canvas coordinates to complex numbers
function canvasToComplex(x, y, canvasWidth, canvasHeight, minX, maxX, minY, maxY) {
    const real = minX + (maxX - minX) * (x / canvasWidth);
    const imag = maxY - (maxY - minY) * (y / canvasHeight);
    return { real: real, imag: imag };
}

// Main function to draw the Mandelbrot set
function drawMandelbrotSet(canvas, minX, maxX, minY, maxY, power, bailout, iterations, R, G, B) {
    const ctx = canvas.getContext('2d');
    const canvasWidth = canvas.width;
    const canvasHeight = canvas.height;

    for (let x = 0; x < canvasWidth; x++) {
        for (let y = 0; y < canvasHeight; y++) {
            const c = canvasToComplex(x, y, canvasWidth, canvasHeight, minX, maxX, minY, maxY);
            const colorRGB = color(c, power, bailout, iterations, R, G, B, subframe);
            ctx.fillStyle = `rgb(${colorRGB[0]}, ${colorRGB[1]}, ${colorRGB[2]})`;
            ctx.fillRect(x, y, 1, 1);
        }
    }
}

// Get canvas element
const canvas = document.getElementById('mandelbrotCanvas');
const power = 2;
const bailout = 6;
const iterations = 100;
const R = 1;
const G = 1;
const B = 1;
const minX = -2.2;
const maxX = 0.8;
const minY = -1.5;
const maxY = 1.5;
const subframe = 0; // This variable is not explicitly provided, but it's used in the GLSL code

// Set canvas dimensions
const width = 400;
const height = 400;

// Draw Mandelbrot set
drawMandelbrotSet(canvas, minX, maxX, minY, maxY, power, bailout, iterations, R, G, B);
</script>
</body>
</html>
